<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Hotel Booking Platform</title>
    <link href="/styles.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="main-content bg-light">

<header class="bg-primary text-white text-center py-3">
    <h1>The Christie Hotel | Room Search</h1>

    <!-- Navigation Buttons for Booking and Checking Booking -->
    <div class="d-flex justify-content-center gap-3 mb-4">
        <button class="btn btn-light btn-lg" onclick="redirectToBooking()">Make A Booking</button>
        <button class="btn btn-light btn-lg" onclick="redirectToCheckBooking()">Check Your Booking</button>
    </div>
</header>

<main class="container mt-4">

    <div id="alert-container"></div>

    <!-- Room Search Form -->
    <div class="card p-4 shadow-sm">
        <form class="d-flex align-items-center justify-content-center gap-2" method="get">
            <label class="form-label mb-0" for="room-select">Search Room Type:</label>
            <input class="form-control w-auto" id="room-select" list="datalistOptions" name="search"
                   placeholder="Enter Room Type...">
            <!-- Predefined room types for user selection -->
            <datalist id="datalistOptions">
                <option value="single">
                <option value="double">
                <option value="suite">
                <option value="luxury suite">
                <option value="presidential suite">
                <option value="penthouse">
            </datalist>
            <input class="btn btn-primary" id="loadRoomsBtn" name="input-submit" type="submit" value="Search">
        </form>
    </div>

    <br>

    <!-- Room Data Section -->
    <div class="custom-room-table" id="data-holder">
        <!-- Room information will be displayed here dynamically -->
    </div>

    <br>

    <script>
        // Reference to the data holder section in the HTML
        const mainInfo = document.getElementById("data-holder");
        const alertArea = document.getElementById("alert-container");

        // Function to fetch and display room data
        async function displayRoomData() {
            const response = await fetch("/api/rooms"); // Fetch room data from the API
            const data = await response.json(); // Parse the response into JSON format

            // Check if an error occurred, if so alert the user
            if (data.error === true) {
                alertArea.innerHTML = `<p class="alert alert-danger" role="alert">Invalid Room Type</p>`;
            } else {
                alertArea.innerHTML = ``;

                // Create a table to display available rooms
                mainInfo.innerHTML = `<div class="custom-container">
            <div class="custom-table-wrapper">
                <table class="custom-table">
                    <thead class="custom-table-head">
                    <tr>
                        <th>Available Rooms</th>
                        <th>Room #</th>
                    </tr>
                    </thead>
                    <tbody id="table-data"></tbody>
                </table>
            </div>
        </div>
                `;

                // Loop through the data and display rooms that are available
                data.forEach(room => {
                    if (room.available === true) {
                        const tableBody = document.getElementById("table-data");

                        // Add each room's name and number to the table
                        tableBody.innerHTML += `
                                    <tr>
                                        <td><a href="/room/${room.room_type}">${room.name}</a></td>
                                        <td>${room.room_number}</td>
                                    </tr>
                                `;
                    }
                });
            }
        }

        // Function to redirect user to the booking page
        function redirectToBooking() {
            window.location.href = "/booking";
        }

        // Function to redirect user to check their booking
        function redirectToCheckBooking() {
            window.location.href = "/findBooking";
        }

        document.getElementById("loadRoomsBtn").addEventListener("submit", displayRoomData());
    </script>
</main>
</body>
<script crossorigin="anonymous"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</html>

